<!DOCTYPE html>
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1">
    <title>Registration page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="./node_modules/intl-tel-input/build/js/intlTelInput-jquery.js"></script>
    <link rel="stylesheet" href="./node_modules/intl-tel-input/build/css/intlTelInput.css">

    <style>

/*         .alert {
            margin-top: 100%;
        } */

        .validMsg {
            color: green;
        }

        .errorMsg {
            color: red;
        }

    </style>

</head>

<body>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

    <div>

        <!-- First part -->
        <div id="first-part">
            <div>
                <label for="first-name">First name*</label>
                <input type="text" id="first-name" required>
            </div>
            <div>
                <label for="last-name">Last name*</label>
                <input type="text" id="last-name" required>
            </div>
            <div>
                <label for="birthdate">Birthdate*</label>
                <input type="date" id="birthdate" required max="2004-12-31">
            </div>
            <div>
                <label for="report">Report subject*</label>
                <input type="text" id="report" required>
            </div>
            <div>
                <form>
                    <label for="phone">Phone*</label>
                    <input id="phone" type="tel" required>
                    <span id="valid-msg" class="validMsg" hidden>Valid</span>
                    <span id="error-msg" class="errorMsg" hidden></span>
                </form>
            </div>
            <div>
                <label for="email">Email*</label>
                <input id="email" type="email" required>
            </div>
            <button type="button" class="btn btn-lg btn-primary" id="next">Next</button>
        </div>

        <!-- Second part -->
        <div id="second-part" hidden>
            <div>
                <label for="company">Company</label>
                <input type="text" id="company">
            </div>
            <div>
                <label for="position">Position</label>
                <input type="text" id="position">
            </div>
            <div>
                <label for="about">About</label>
                <input type="text" id="about">
            </div>
            <div>
                <label for="photo">Photo</label>
                <input type="file" id="photo">
            </div>
            <button type="button" class="btn btn-lg btn-primary" id="back">Back</button>
        </div>

    </div>

    <script src="./node_modules/intl-tel-input/build/js/intlTelInput.js"></script>

<!-- International number phone -->
<script>
    var phoneInputField = document.querySelector("#phone"),
        errorMsg = document.querySelector("#error-msg"),
        validMsg = document.querySelector("#valid-msg");

    var errorMap = ["Invalid number", "Too short", "Too long"]

    var iti = window.intlTelInput(phoneInputField, {
        initialCountry: "auto",
        utilsScript: "./node_modules/intl-tel-input/build/js/utils.js",
        geoIpLookup: function(success, failure) {
            $.get("https://ipinfo.io", function() {}, "jsonp").always(function(resp) {
                var countryCode = (resp && resp.country) ? resp.country : "";
                success(countryCode);
            })
        }
    });

    var reset = function () {
        phoneInputField.classList.remove("error");
        errorMsg.innerHTML = "";
        errorMsg.hidden = true;
        validMsg.hidden = true;
    };

    phoneInputField.addEventListener('blur', function () {
        reset();
        if (phoneInputField.value.trim()) {
            if (iti.isValidNumber()) {
                validMsg.hidden = false;
            } else {
                phoneInputField.classList.add("error")
                var errorCode = iti.getValidationError();
                errorMsg.innerHTML = errorMap[errorCode];
                errorMsg.hidden = false;
            }
        }
    })


    /* Переход от первой части к второй части регистрации */
/*     document.getElementById("next").addEventListener("click", function () {
        if (localStorage !== undefined) {
            document.getElementById("first-part").hidden = true;
            document.getElementById("next").hidden = true;
            document.getElementById("second-part").hidden = false;
        } else {
            print("All is empty")
    }}, false); */
</script>

<!-- Local Storage -->
<script>
    var myStorage = window.localStorage,
        nextButton = document.querySelector("#next"),
        backButton = document.querySelector("#back"),
        firstPart = document.querySelector("#first-part"),
        secondPart = document.querySelector("#second-part");

    var firstName = document.querySelector("#first-name"),
        lastName = document.querySelector("#last-name"),
        birthdate = document.querySelector("#birthdate"),
        report = document.querySelector("#report"),
        numberPhone = document.querySelector("#phone"),
        email = document.querySelector("#email");

    firstName.addEventListener("blur", function () {
        myStorage.setItem('firstName', firstName.value);
    })

    lastName.addEventListener("blur", function () {
        myStorage.setItem('lastName', lastName.value);
    })
    
    birthdate.addEventListener("blur", function () {
        myStorage.setItem('birthdate', birthdate.value);
    })
    
    report.addEventListener("blur", function () {
        myStorage.setItem('report', report.value);
    })
    
    numberPhone.addEventListener("blur", function () {
        myStorage.setItem('phone', numberPhone.value);
    })
    
    email.addEventListener("blur", function () {
        myStorage.setItem('email', email.value);
    })

    /* Переход между первой и второй частью регистрации */
    nextButton.addEventListener("click", function () {
        if (myStorage.length !== 6 || errorMsg.hidden == false) {
            print("Error");
        } else {
            firstPart.hidden = true;
            secondPart.hidden = false;
        }
    });

    backButton.addEventListener("click", function() {
        firstPart.hidden = false;
        secondPart.hidden = true;
    });
    
    /* Восстановление данных из localStorage */
    if (myStorage.length !== 0) {
            firstName.value = myStorage.getItem('firstName')
            lastName.value = myStorage.getItem('lastName')
            birthdate.value = myStorage.getItem('birthdate')
            report.value = myStorage.getItem('report')
            numberPhone.value = myStorage.getItem('phone')
            email.value = myStorage.getItem('email')
        }
</script>

</body>
